<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>關卡五：打造健康棲地（方案2）</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", sans-serif;
      margin: 0; padding: 0;
      background: #d8f0d8;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    h1 {
      margin-top: 20px;
    }
    #game {
      display: flex;
      gap: 50px;
      margin-top: 20px;
    }
    #items {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .draggable {
      width: 100px;
      height: 100px;
      cursor: grab;
    }
    #targets {
      display: flex;
      gap: 25px;
    }
    .dropzone {
      width: 120px;
      height: 120px;
      border: 2px dashed #666;
      background-color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }
    .dropzone.correct {
      border-color: green;
    }
    .dropzone.incorrect {
      border-color: red;
    }
    #message {
      margin-top: 20px;
      font-size: 18px;
      min-height: 28px;
    }
    button {
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #restartBtn {
      background-color: #f44336;
      color: white;
    }
    #nextBtn {
      background-color: #4caf50;
      color: white;
      display: none;
    }
  </style>
</head>
<body>

<!-- 🔊 背景音樂 -->
<audio id="bgMusic" src="impage/background.mp3" autoplay loop></audio>
<script>
  const bgMusic = document.getElementById("bgMusic");
  bgMusic.volume = 0.3;
</script>

<h1>關卡五：打造健康棲地</h1>
<div id="game">
  <div id="items">
    <img src="images/bear.png" class="draggable" draggable="true" data-target="forest" alt="黑熊" id="bear" title="黑熊 → 森林" />
    <img src="images/frog.png" class="draggable" draggable="true" data-target="wetland" alt="青蛙" id="frog" title="青蛙 → 濕地" />
    <img src="images/sparrow.png" class="draggable" draggable="true" data-target="farm" alt="麻雀" id="sparrow" title="麻雀 → 農田" />
    <img src="images/factory.png" class="draggable" draggable="true" data-target="wrong" alt="工廠" id="factory" title="工廠 → 錯誤項目" />
  </div>
  <div id="targets">
    <div class="dropzone" data-name="forest" title="森林">
      <img src="images/forest.png" alt="森林" width="100" />
    </div>
    <div class="dropzone" data-name="wetland" title="濕地">
      <img src="images/wetland.png" alt="濕地" width="100" />
    </div>
    <div class="dropzone" data-name="farm" title="農田">
      <img src="images/farm.png" alt="農田" width="100" />
    </div>
  </div>
</div>

<div id="message">請將動物與物件拖曳到正確棲地</div>
<button id="restartBtn" onclick="initGame()">重新開始</button>
<button id="nextBtn" onclick="location.href='end.html'">完成遊戲</button>

<script>
  let correctCount = 0;
  const totalCorrect = 3;

  function initGame() {
    correctCount = 0;
    document.getElementById('message').textContent = '請將動物與物件拖曳到正確棲地';
    document.getElementById('nextBtn').style.display = 'none';

    document.querySelectorAll('.draggable').forEach(item => {
      item.style.visibility = 'visible';
      item.draggable = true;
    });

    document.querySelectorAll('.dropzone').forEach(zone => {
      zone.classList.remove('correct', 'incorrect');
    });
  }

  document.querySelectorAll('.dropzone').forEach(zone => {
    zone.addEventListener('dragover', e => e.preventDefault());

    zone.addEventListener('drop', e => {
      e.preventDefault();
      const dragged = document.querySelector('.dragging');
      if (!dragged) return;

      const dropName = zone.getAttribute('data-name');
      const targetName = dragged.getAttribute('data-target');

      if (targetName === dropName) {
        zone.classList.add('correct');
        dragged.style.visibility = 'hidden';
        dragged.draggable = false;
        correctCount++;
        document.getElementById('message').textContent = `✔️ 放置正確！已完成 ${correctCount} / ${totalCorrect}`;
      } else {
        zone.classList.add('incorrect');
        document.getElementById('message').textContent = '❌ 放置錯誤，挑戰失敗，請重新開始';
        document.querySelectorAll('.draggable').forEach(item => item.draggable = false);
        return;
      }

      if (correctCount >= totalCorrect) {
        document.getElementById('message').textContent = '🎉 挑戰成功！';
        document.getElementById('nextBtn').style.display = 'inline-block';
      }
    });
  });

  document.querySelectorAll('.draggable').forEach(item => {
    item.addEventListener('dragstart', () => {
      item.classList.add('dragging');
    });
    item.addEventListener('dragend', () => {
      item.classList.remove('dragging');
    });
  });

  initGame();
</script>
</body>
</html>
